<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>ring.middleware.transit documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Ring-transit-middleware</span> <span class="project-version">0.1.4-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="ring.middleware.transit.html"><div class="inner"><span>ring.middleware.transit</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="ring.middleware.transit.html#var-decode"><div class="inner"><span>decode</span></div></a></li><li class="depth-1"><a href="ring.middleware.transit.html#var-encode"><div class="inner"><span>encode</span></div></a></li><li class="depth-1"><a href="ring.middleware.transit.html#var-wrap-transit"><div class="inner"><span>wrap-transit</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">ring.middleware.transit</h1><div class="doc"><div class="markdown"><p>Ring middleware for Transit requests &amp; responses.</p>
<p>For basic usage you just need to add <a href="ring.middleware.transit.html#var-wrap-transit">wrap-transit</a> middleware.</p>
<h4><a href="#usage-example-" name="usage-example-"></a>Usage Example:</h4>
<pre><code>(require '[ring.middleware.transit :refer [wrap-transit]])


(defn handler [request]
  (let [username (get-in request [:params :username])]
    {:hello username}))


(defn app
  (-&gt; handler
      (wrap-transit)))
</code></pre>
<p><a href="ring.middleware.transit.html#var-encode">encode</a> &amp; <a href="ring.middleware.transit.html#var-decode">decode</a> are provided for reusing of options to <a href="ring.middleware.transit.html#var-wrap-transit">wrap-transit</a> when encoding/decoding Transit outside of HTTP requests/responses. When using WebSockets or communicating with other services.</p>
<p>If you want to write a custom middleware based on this code take a look at <code>-decode-request</code> &amp; <code>-encode-response</code> functions. They are not documented.</p></div></div><div class="public anchor" id="var-decode"><h3>decode</h3><div class="usage"><code>(decode s)</code><code>(decode s options)</code></div><div class="doc"><div class="markdown"><p>Decode string Transit data.</p>
<h4><a href="#parameters-" name="parameters-"></a>Parameters:</h4>
<dl>
  <dt>s</dt>
  <dd>Transit data. Note that unlike <code>cognitect.transit/reader</code> this function takes a <code>String</code>.</dd>
  <dt>options</dt>
  <dd>Optional parameter. This is a map that will be passed to <code>cognitect.transit/reader</code> as its third argument. Additionally <code>decode</code>’s <code>options</code> map can contain <code>:encoding</code>:
    <dl>
      <dt>:encoding
      </dt>
      <dd>Transit reader’s encoding. Default is <code>:json</code>. Passed to <code>reader</code> as its second argument.</dd>
    </dl>
    <p>An example options map:</p>
    <pre><code>{:encoding :json
 :handlers {Foo (FooHandler.)}
 :default-handler (DefaultHandler.)}
</code></pre>
    <p><code>:encoding</code> key stripped from <code>options</code> before calling <code>reader</code>.</p>
  </dd>
</dl></div></div><div class="src-link"><a href="https://github.com/muhuk/ring-transit-middleware/blob/master/src/ring/middleware/transit.clj#L64">view source</a></div></div><div class="public anchor" id="var-encode"><h3>encode</h3><div class="usage"><code>(encode v)</code><code>(encode v options)</code></div><div class="doc"><div class="markdown"><p>Encode some value into string Transit data.</p>
<h4><a href="#parameters-" name="parameters-"></a>Parameters:</h4>
<dl>
  <dt>v</dt>
  <dd>Value to be encoded.</dd>
  <dt>options</dt>
  <dd>Optional parameter. This is a map that will be passed to <code>cognitect.transit/writer</code> as its third argument. Additionally there are two more keys accepted:
    <dl>
      <dt>:buffer-size
      </dt>
      <dd>Size of the buffer of the output stream, in bytes. Default is <code>1024</code>.</dd>
      <dt>:encoding
      </dt>
      <dd>Transit writer’s encoding. Default is <code>:json</code>. Passed to <code>reader</code> as its second argument.</dd>
    </dl>
    <p>An example options map:</p>
    <pre><code>{:buffer-size 4096
 :encoding :json-verbose
 :handlers {Foo (FooHandler.)}}
</code></pre>
    <p><code>:buffer-size</code> &amp; <code>:encoding</code> keys are stripped from <code>options</code> before calling <code>writer</code>.</p>
  </dd>
</dl></div></div><div class="src-link"><a href="https://github.com/muhuk/ring-transit-middleware/blob/master/src/ring/middleware/transit.clj#L102">view source</a></div></div><div class="public anchor" id="var-wrap-transit"><h3>wrap-transit</h3><div class="usage"><code>(wrap-transit handler)</code><code>(wrap-transit handler options)</code></div><div class="doc"><div class="markdown"><p>Decodes Transit requests and encodes Transit responses.</p>
<h4><a href="#parameters-" name="parameters-"></a>Parameters:</h4>
<dl>
  <dt>handler</dt>
  <dd>Ring handler to wrap.</dd>
  <dt>options</dt>
  <dd>Optional parameter. A map of options that can contain a <code>:reader</code> and a <code>:writer</code> keys which correspond to options to be passed to <a href="ring.middleware.transit.html#var-decode">decode</a> and <a href="ring.middleware.transit.html#var-encode">encode</a> respectively.
    <p><code>[:reader :encoding]</code> will always be overwritten using the <code>Content-Type</code> header of the request.</p>
  </dd>
</dl>
<h4><a href="#transit-requests" name="transit-requests"></a>Transit Requests</h4>
<p>Decoded Transit messages can be accessed through request’s <code>:transit-params</code> key. If the decoded object is a map, it will be also be merged with request’s <code>:params</code>.</p>
<p>For Transit requests, <code>:body</code> is read into a string and is available to downstream.</p>
<h4><a href="#transit-responses" name="transit-responses"></a>Transit Responses</h4>
<p>If there is no <code>Content-Type</code> header, anything but the types ring accepts as valid response bodies are encoded. If <code>Content-Type</code> is present it overrides the type of <code>:body</code>.</p>
<table>
  <thead>
    <tr>
      <th>Content Type Header </th>
      <th>Response Type </th>
      <th align="center">Encoded? </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Not present. </td>
      <td><code>String</code>, <code>InputStream</code>, <code>File</code> or <code>ISeq</code> </td>
      <td align="center">No. </td>
    </tr>
    <tr>
      <td>Not present. </td>
      <td>Anything else. </td>
      <td align="center">Yes. </td>
    </tr>
    <tr>
      <td>application/transit </td>
      <td>Anything. </td>
      <td align="center">Yes. </td>
    </tr>
    <tr>
      <td>Other content type </td>
      <td>Anything. </td>
      <td align="center">No. </td>
    </tr>
  </tbody>
</table>
<h4><a href="#aleph-support" name="aleph-support"></a>Aleph Support</h4>
<p>If you have <a href="http://aleph.io/">Aleph</a> in your classpath deferred responses will be handled properly using <code>manifold.deferred/chain</code>.</p></div></div><div class="src-link"><a href="https://github.com/muhuk/ring-transit-middleware/blob/master/src/ring/middleware/transit.clj#L150">view source</a></div></div></div></body></html>